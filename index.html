<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Tarjeta - Sobre rosado (Interactiva)</title>
  <style>
    :root{--pink:#ff8fb2;--pink-dark:#ff6b97;--card-bg:#fff7fb}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Arial,sans-serif;background:linear-gradient(135deg,#ffd6e8 0%,#c9f0ff 100%);-webkit-font-smoothing:antialiased}
    .stage{height:100vh;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}

    /* Envelope container */
    .envelope-wrap{width:420px;height:260px;position:relative;perspective:1200px}
    .envelope{width:100%;height:100%;position:relative;border-radius:12px;transform-style:preserve-3d;transition:transform .9s cubic-bezier(.2,.9,.3,1);}

    /* Envelope body */
    .body{position:absolute;inset:0;background:linear-gradient(180deg,var(--pink),var(--pink-dark));border-radius:12px;box-shadow:0 20px 40px rgba(0,0,0,0.15);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:20px}

    /* Flap */
    .flap{position:absolute;left:0;right:0;top:0;height:60%;background:linear-gradient(180deg,#ffd6e8,#ff7aa6);border-top-left-radius:12px;border-top-right-radius:12px;transform-origin:center top;transition:transform .8s cubic-bezier(.2,.9,.3,1);box-shadow:0 8px 18px rgba(0,0,0,0.12)}
    .envelope.open .flap{transform:rotateX(-160deg) translateY(-8px)}

    /* Paper inside */
    .paper{position:absolute;left:10px;right:10px;bottom:16px;height:70%;background:var(--card-bg);border-radius:8px;padding:22px;box-shadow:0 10px 30px rgba(0,0,0,0.12);transform:translateY(40px);transition:transform .9s cubic-bezier(.2,.9,.3,1);z-index:2;overflow:hidden}
    .envelope.open .paper{transform:translateY(-120%)}

    /* Give the paper the 'old card' look */
    .paper h1{margin:0;font-size:26px;color:#333}
    .paper p{color:#444;line-height:1.5;margin-top:12px}
    .actions{display:flex;gap:10px;margin-top:16px}
    .btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
    .btn-primary{background:var(--pink-dark);color:white}
    .btn-ghost{background:transparent;border:1px solid rgba(0,0,0,0.06)}

    /* Subtle 'touch me' vibration */
    @keyframes pulseTouch{0%{transform:translateY(0) rotate(0)}30%{transform:translateY(-6px) rotate(-1deg)}60%{transform:translateY(0) rotate(1deg)}100%{transform:translateY(0) rotate(0)}}
    .envelope.idle{animation:pulseTouch 2.6s ease-in-out infinite;}

    /* Shadow for realism */
    .shadow{position:absolute;left:8px;right:8px;bottom:-12px;height:30px;border-radius:50%;filter:blur(18px);background:linear-gradient(90deg,rgba(0,0,0,0.25),rgba(0,0,0,0.15));opacity:.8;transform:translateY(6px)}

    /* Cake overlay */
    .overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:80;opacity:0;pointer-events:none;transition:opacity .4s}
    .overlay.show{opacity:1;pointer-events:auto}
    .cake-card{width:760px;max-width:94%;background:linear-gradient(180deg,#fff,#fff4f8);padding:28px;border-radius:18px;box-shadow:0 30px 80px rgba(0,0,0,0.3);text-align:center;position:relative}
    .cake-emoji{font-size:160px;display:block;margin:6px auto;transform-origin:center bottom;animation:pop .9s cubic-bezier(.2,.9,.3,1)}
    @keyframes pop{0%{transform:scale(.6)}60%{transform:scale(1.06)}100%{transform:scale(1)}}
    .cake-title{font-size:28px;margin:8px 0}
    .overlay .close{position:absolute;right:18px;top:18px;background:transparent;border:0;color:#333;font-weight:700;cursor:pointer}

    /* Confetti full-screen canvas above everything */
    #confetti{position:fixed;left:0;top:0;right:0;bottom:0;pointer-events:none;z-index:100}

    /* Responsive tweaks */
    @media (max-width:540px){.envelope-wrap{width:320px;height:200px}.paper{padding:16px}.cake-emoji{font-size:110px}}
  </style>
</head>
<body>
  <div class="stage">
    <div class="envelope-wrap">
      <div class="envelope idle" id="envelope" role="button" tabindex="0" aria-label="Tocar para abrir la carta">
        <div class="flap" id="flap"></div>
        <div class="body">Toca para abrir</div>
        <div class="paper" id="paper">
          <!-- AquÃ­ va el diseÃ±o antiguo de la carta: editable por ti -->
          <h1 id="cardTitle">Â¡Feliz cumpleaÃ±os, Amor!</h1>
          <p id="cardText">(Escribe tu mensaje aquÃ­. Puedes editar el contenido dentro del HTML.)</p>
          <div class="actions">
            <button class="btn btn-primary" id="viewCake">ðŸŽ‚ Ver pastel</button>
            <button class="btn btn-ghost" id="downloadPdf">ðŸ“„ Descargar carta (PDF)</button>
          </div>
        </div>
        <div class="shadow" aria-hidden></div>
      </div>
    </div>
  </div>

  <!-- overlay para el pastel grande -->
  <div class="overlay" id="overlay">
    <div class="cake-card" role="dialog" aria-modal="true" aria-label="Pastel de cumpleaÃ±os">
      <button class="close" id="closeOverlay">Cerrar âœ•</button>
      <div class="cake-emoji" id="cakeEmoji">ðŸŽ‚</div>
      <div class="cake-title">Â¡Que todos tus deseos se hagan realidad!</div>
      <p style="color:#444">Pulsa fuera o en Cerrar para volver a la carta.</p>
    </div>
  </div>

  <canvas id="confetti"></canvas>

  <script>
    // Elementos
    const envelope = document.getElementById('envelope');
    const flap = document.getElementById('flap');
    const paper = document.getElementById('paper');
    const overlay = document.getElementById('overlay');
    const viewCakeBtn = document.getElementById('viewCake');
    const closeOverlay = document.getElementById('closeOverlay');
    const downloadPdfBtn = document.getElementById('downloadPdf');

    // Open state
    let opened = false;

    // Accessibility: open with Enter/Space
    envelope.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); envelope.click(); }});

    // Click to open: flap animation + slide paper up
    envelope.addEventListener('click', ()=>{
      if(opened) return; opened = true;
      envelope.classList.remove('idle');
      envelope.classList.add('open');
      // animate flap (using class toggle)
      // Delay to allow flap to rotate then slide paper
      setTimeout(()=>{
        // paper translation is handled by CSS .envelope.open .paper
      }, 300);
    });

    // Cake overlay handling
    viewCakeBtn.addEventListener('click', ()=>{
      showCake();
    });
    closeOverlay.addEventListener('click', hideCake);
    overlay.addEventListener('click', (e)=>{ if(e.target===overlay) hideCake(); });

    // Confetti: appear only when cake overlay shows
    const confettiCanvas = document.getElementById('confetti');
    const ctx = confettiCanvas.getContext('2d');
    let W=confettiCanvas.width=window.innerWidth; let H=confettiCanvas.height=window.innerHeight;
    window.addEventListener('resize', ()=>{ W=confettiCanvas.width=window.innerWidth; H=confettiCanvas.height=window.innerHeight; });

    function rand(min,max){return Math.random()*(max-min)+min}

    let confettiPieces = [];
    let confettiAnimId = null;
    function startConfetti(){
      confettiPieces = [];
      const count = Math.max(150, Math.floor((W*H)/10000));
      for(let i=0;i<count;i++){
        confettiPieces.push({x:rand(0,W),y:rand(-H,0),w:rand(6,14),h:rand(8,18),vx:rand(-2,2),vy:rand(1,4),rot:rand(0,360),vrot:rand(-8,8),color:`hsl(${rand(0,360)},80%,60%)`});
      }
      function frame(){
        ctx.clearRect(0,0,W,H);
        for(const p of confettiPieces){
          p.x += p.vx; p.y += p.vy; p.vy += 0.02; p.rot += p.vrot;
          ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot*Math.PI/180);
          ctx.fillStyle = p.color; ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
          ctx.restore();
          if(p.y>H+50){ p.y = rand(-H,0); p.x = rand(0,W); p.vy = rand(1,3); }
        }
        confettiAnimId = requestAnimationFrame(frame);
      }
      frame();
    }
    function stopConfetti(){ if(confettiAnimId) cancelAnimationFrame(confettiAnimId); ctx.clearRect(0,0,W,H); confettiAnimId = null; }

    function showCake(){ overlay.classList.add('show'); startConfetti(); // stop confetti after some time
      // Stop confetti after 8s
      setTimeout(()=>{ stopConfetti(); }, 8000);
    }
    function hideCake(){ overlay.classList.remove('show'); stopConfetti(); }

    // Download PDF: open new window with printable content and call print()
    downloadPdfBtn.addEventListener('click', ()=>{
      const title = document.getElementById('cardTitle').innerText;
      const text = document.getElementById('cardText').innerHTML;
      const printable = `<!doctype html><html><head><meta charset=\"utf-8\"><title>${title}</title><style>body{font-family:Arial,Helvetica,sans-serif;padding:40px;color:#222} .paper{max-width:700px;margin:0 auto;padding:30px;border:1px solid #eee;border-radius:8px;background:#fff}</style></head><body><div class=\"paper\"><h1>${title}</h1><div>${text}</div></div></body></html>`;
      const win = window.open('about:blank','_blank');
      win.document.write(printable);
      // Give the window a moment to render
      setTimeout(()=>{ try{ win.focus(); win.print(); /* user can choose "Save as PDF" */ }catch(e){ console.error(e); } }, 400);
    });

    // Prevent envelope from vibrating after opened
    // (just in case user closes and wants to re-open, we keep it open)

    // Small enhancement: keyboard shortcut C to view cake for demo
    document.addEventListener('keydown', (e)=>{ if(e.key.toLowerCase()==='c'){ showCake(); } });
  </script>
</body>
</html>
